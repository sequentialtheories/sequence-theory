<analysis>
The user’s primary goal is to fix the wallet creation flow.
Currently, after a user enters the correct email OTP code, the application crashes and no wallet is created.

The working hypothesis is that the backend is not completing Turnkey’s OTP flow correctly — specifically, it appears to be using the wrong Turnkey activity (ACTIVITY_TYPE_OTP_AUTH) instead of the correct ACTIVITY_TYPE_VERIFY_OTP.

The frontend branding and content work (renaming “The Vault Club” → “TVC” and removing deprecated mechanics like group investing, RRL, and lockups) has already been completed and is out of scope for this fix.

what currently exists (CLEAN VERSION)

The system consists of a React frontend and a Python FastAPI backend using Supabase for authentication and Postgres for storage. Wallet operations are handled through a custom Turnkey client (turnkey_client.py) following Turnkey’s Delegated Access (Backend) pattern.

The backend successfully:

creates a Turnkey sub-organization during init-email-auth

sends the OTP email correctly

The failure occurs after the user enters the OTP code.

Issue 1 — OTP verification failure (P0)
Diagnosis (unchanged, but clarified)

The backend currently uses the deprecated Turnkey activity ACTIVITY_TYPE_OTP_AUTH, which is unsuitable for this server-side delegated access model and requires a targetPublicKey that does not apply here.

Turnkey documentation indicates the correct activity is:

ACTIVITY_TYPE_VERIFY_OTP

Immediate tasks (your checklist is correct)

Add a new method in backend/turnkey_client.py for ACTIVITY_TYPE_VERIFY_OTP.

Update POST /api/turnkey/verify-email-otp in backend/server.py to call this new method.

On success, mark the user as verified in verified_users and store their sub_org_id in verified_sub_orgs.

Do not implement OTP_LOGIN unless Turnkey explicitly requires it for this backend pattern.

Testing plan (slightly improved)

Backend first:

POST /api/turnkey/init-email-auth → should send email

POST /api/turnkey/verify-email-otp → should return { isVerified: true }

POST /api/turnkey/create-wallet → should return wallet

Then spot-check frontend:

Enter OTP in TVC → wallet appears without crash.
</analysis>
